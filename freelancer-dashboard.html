<!DOCTYPE html>
<html>
<head>
    <title>Freelancer Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        .dark-mode { background-color: #121212 !important; color: white !important; }
        .dark-mode .card { background-color: #1f1f1f !important; color: white !important; }
        .dark-mode input, .dark-mode textarea { background-color: #222 !important; color: white !important; border-color: #444 !important; }
    </style>
</head>
<body class="container py-5">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3 mb-4">
  <a class="navbar-brand" href="#">WorkHub</a>
  <div class="ms-auto d-flex align-items-center">
    <div class="dropdown me-3">
      <button class="btn btn-secondary dropdown-toggle" id="notifBtn" data-bs-toggle="dropdown">
        Notifications <span id="notifCount" class="badge bg-danger">0</span>
      </button>
      <ul id="notifList" class="dropdown-menu dropdown-menu-end"></ul>
    </div>
    <button id="darkToggle" class="btn btn-outline-light">ðŸŒ™ Dark Mode</button>
  </div>
</nav>

<h2>Available Jobs</h2>
<div id="jobList" class="mt-3"></div>

<script src="utils.js"></script>
<script>
async function loadJobs() {
    const jobs = await apiRequest("/jobs");
    jobList.innerHTML = jobs.map(job => `
        <div class="card p-4 mb-4">
            <h4>${job.title}</h4>
            <p>${job.description}</p>
            <textarea id="proposal-${job._id}" class="form-control mb-3" placeholder="Write your proposal"></textarea>
            <button class="btn btn-primary" onclick="applyToJob('${job._id}')">Apply</button>
            ${
                job.acceptedFreelancer === getUserId()
                ? `<button class="btn btn-warning mt-2" onclick="markJobCompleted('${job._id}')">Mark Completed</button>`
                : ""
            }
        </div>
    `).join("");
}

async function applyToJob(jobId) {
    const proposal = document.getElementById(`proposal-${jobId}`).value;
    await apiRequest(`/jobs/${jobId}/apply`, "POST", { proposal });
    alert("Applied!");
}

document.addEventListener("DOMContentLoaded", () => {
    loadDarkMode();
    const btn = document.getElementById("darkToggle");
    if (btn) btn.onclick = toggleDarkMode;
    loadJobs();
    loadNotifications();
});
</script>
</body>
</html>
