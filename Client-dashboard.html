<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        .dark-mode { background-color: #121212 !important; color: white !important; }
        .dark-mode .card { background-color: #1f1f1f !important; color: white !important; }
        .dark-mode input, .dark-mode textarea { background-color: #222 !important; color: white !important; border-color: #444 !important; }
    </style>
</head>
<body class="container py-5">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3 mb-4">
  <a class="navbar-brand" href="#">WorkHub</a>
  <div class="ms-auto d-flex align-items-center">
    <div class="dropdown me-3">
      <button class="btn btn-secondary dropdown-toggle" id="notifBtn" data-bs-toggle="dropdown">
        Notifications <span id="notifCount" class="badge bg-danger">0</span>
      </button>
      <ul id="notifList" class="dropdown-menu dropdown-menu-end"></ul>
    </div>
    <button id="darkToggle" class="btn btn-outline-light">ðŸŒ™ Dark Mode</button>
  </div>
</nav>

<h2 class="mb-4">Create Job</h2>
<div class="card p-4 mb-5">
    <input id="title" class="form-control mb-2" placeholder="Job Title">
    <textarea id="description" class="form-control mb-2" placeholder="Job Description"></textarea>
    <input id="amount_fiat" class="form-control mb-2" placeholder="Amount (FIAT)">
    <input id="amount_btc" class="form-control mb-2" placeholder="Amount (BTC)">
    <input id="deadline" class="form-control mb-3" type="date">
    <button class="btn btn-primary w-100" onclick="createJob()">Create Job</button>
</div>

<h2>Your Jobs</h2>
<div id="jobList" class="mt-3"></div>

<script src="utils.js"></script>
<script>
async function createJob() {
    const job = {
        title: title.value,
        description: description.value,
        amount_fiat: amount_fiat.value,
        amount_btc: amount_btc.value,
        deadline: deadline.value,
        milestones: []
    };
    await apiRequest("/jobs", "POST", job);
    alert("Job Created!");
    loadJobs();
}

async function loadJobs() {
    const jobs = await apiRequest("/jobs/my");
    jobList.innerHTML = jobs.map(job => `
        <div class="card p-4 mb-4">
            <h4>${job.title}</h4>
            <p>${job.description}</p>
            <strong>Applicants:</strong>
            <ul>
                ${
                    job.applicants.length === 0
                    ? "<p>No applicants yet.</p>"
                    : job.applicants.map(a => `
                        <li>
                            ${a.freelancer.name} â€“ "${a.proposal}"
                            <button class="btn btn-sm btn-success ms-2"
                                onclick="acceptFreelancer('${job._id}', '${a.freelancer._id}')">
                                Accept
                            </button>
                        </li>
                    `).join("")
                }
            </ul>
            <hr>
            <div>
                <p>Status: <strong>${job.status}</strong></p>
                ${
                    job.status === "submitted" ? 
                    `<button class="btn btn-warning" onclick="approveCompletion('${job._id}')">Approve Completion</button>` 
                    : ""
                }
                ${
                    job.status === "approved" ?
                    `<button class="btn btn-success mt-2" onclick="releasePayment('${job._id}')">Release Payment</button>`
                    : ""
                }
            </div>
        </div>
    `).join("");
}

document.addEventListener("DOMContentLoaded", () => {
    loadDarkMode();
    const btn = document.getElementById("darkToggle");
    if (btn) btn.onclick = toggleDarkMode;
    loadJobs();
    loadNotifications();
});
</script>
</body>
</html>
